#!/usr/bin/env perl 

use strict;
use warnings;

BEGIN {
    require Cwd;
	require File::Basename;
    my $lib_dir = Cwd::abs_path(File::Basename::dirname(__FILE__) . '/../lib/');
    unless (grep { $lib_dir eq Cwd::abs_path($_) } @INC) {
        push @INC, $lib_dir;
    }
}

require Defaults;
require Snapshot;


my $snapshot_version = $ENV{SNAPSHOT_VERSION} || die;
my $snapshot_dir = Snapshot::find_snapshot($snapshot_version);
my $snapshot = Snapshot->open($snapshot_dir);
print "Opened snapshot at $snapshot_dir\n";

my $builds_passed = !system("cd $snapshot_dir/lib/perl && " . Defaults::BIN_DIR() . "/apipe_tests " . join(' ', @ARGV));

if ( $builds_passed ) {
	print "Passed builds\n";
	exit;
} else {
	print "Failed builds\n";
	exit 1;
}

