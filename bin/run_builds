#!/usr/bin/env perl

BEGIN {
	require File::Basename;
	push @INC, File::Basename::dirname(__FILE__) . '/../lib/';
}

use strict;
use warnings;

require Defaults;
require Snapshot;

my $snapshot_version = $ENV{SNAPSHOT_VERSION} || die;
my $snapshot_dir = Snapshot::find_snapshot($snapshot_version);
my $snapshot = Snapshot->open($snapshot_dir);
print "Opened snapshot at $snapshot_dir\n";

my $builds_passed = !system("cd $snapshot_dir/lib/perl && " . Defaults::BIN_DIR() . "/apipe_tests");

if ( $builds_passed ) {
	print "Passed builds\n";
	exit;
} else {
	print "Failed builds\n";
	exit 1;
}

