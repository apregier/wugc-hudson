#!/bin/bash

set -o errexit
set -o nounset

echo -en "\n=> Rebuilding Meta DB..." 1>&2
find "$WORKSPACE" -iname '*sqlite3-dump' -or -iname '*sqlite3n-dump' | while read DB_TXT; do
    echo -n '.' 1>&2
    DB_BIN=${DB_TXT/-dump/}
    if [[ "$DB_BIN" -ot "$DB_TXT" ]]; then
        rm -f "$DB_BIN"
        sqlite3 "$DB_BIN" < "$DB_TXT"
    fi
done
echo ' done' 1>&2
